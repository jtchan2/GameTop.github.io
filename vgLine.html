<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <title>Title</title>
</head>
<body>
<script>
    var canvasWidth=700;
    var canvasHeight=700;
    var margin= 200;
    var colors=["rgb(33, 118, 43)","rgb(231, 47, 68)","rgb(27, 107, 240)","rgb(240, 198, 15)","rgb(192, 71, 197)","rgb(215, 119, 130)","rgb(43, 220, 194)","rgb(111, 57, 20)","rgb(229, 175, 122)","rgb(38, 31, 34)","coral","maroon"]
    var svg = d3.select("body").append("svg")
        .attr("width",  canvasWidth)
        .attr("height", canvasHeight)
    var width = svg.attr("width") - margin;
    var height = svg.attr("height") - margin;
    var xScale= d3.scaleTime().range([0,width]);
    var yScale= d3.scaleLinear().range([height,0]);
    var container_g = svg.append("g")
        .attr("transform",
            "translate(" + 100 + ", " + 100 + ")");
    var date="12/31/"
    const format= d3.format("$.2s");
    var genre_data= new Set();
    var years_data= new Set();
    var total2=[];
    d3.csv("vgsales.csv").then(data=>{
        data.forEach(game=>{
            genre_data.add(game.Genre)
            if(game.Year!="N/A"){
                years_data.add(game.Year)
            }

        })
        years_data= Array.from(years_data).sort();
        console.log(years_data)
        console.log(genre_data)

        genre_data.forEach(genre=>{

            var array= new Array(years_data.length)
            for(let i=0; i<array.length; i++){
                array[i]=0
            }
            data.forEach(item=>{
                if(item.Genre==genre){
                    for(let i=0; i<years_data.length; i++){
                        if(item.Year==years_data[i]){
                            array[i]= (+item.Global_Sales)+array[i]
                        }
                    }
                }
            })
            //console.log(genre)
            //console.log(array)
            var tgenre= [];
            for(let i=0; i<years_data.length; i++){
                tgenre.push({year:d3.timeParse("%m/%d/%Y")(date+years_data[i]),sales:array[i], id:genre})
            }
            //console.log(tgenre)
            total2.push(tgenre);
            //console.log(total2)
        })
        console.log(total2[0][0].id)
        xScale.domain(d3.extent(total2[0], function(d){
            return d.year;
        }))
        var maxval=0;
        for(let i=0; i<total2.length; i++){
            let tempval=d3.max(total2[i],function(d){
                return d.sales;
            })
            if(tempval>maxval){
                maxval=tempval;
            }
        }
        yScale.domain([0,maxval])
        container_g.append("g")
            .attr("transform", "translate(0, " + height + ")")
            .call(d3.axisBottom(xScale))
            .append("text")
            .attr("y", 50)
            .attr("x", 250)
            .attr("stroke", "black")
            .text("Years")
        container_g.append("g")
            .call(d3.axisLeft(yScale).tickFormat(function(d) {
                return format(d);
            }).ticks(10))
            .append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", -20)
            .attr("x", -200)
            .attr("dy", "-5.1em")
            .attr("stroke", "black")
            .text("Millions in Sales")
        for(let run=0; run<total2.length; run++){
            container_g.append("path").datum(total2[run])
                .attr("fill", "none")
                .attr("stroke", "coral")
                .attr("stroke-width",2)
                .attr("d",d3.line().x(function(d){
                    return xScale(d.year);
                }).y(function(d){
                    return yScale(d.sales);
                })).attr("id",total2[run][0].id)
        }
        for(let run=0; run<total2.length; run++){
            container_g.append("path").datum(total2[run])
                .attr("fill", "none")
                .attr("stroke", colors[run])
                .attr("stroke-width",2)
                .attr("d",d3.line().x(function(d){
                    return xScale(d.year);
                }).y(function(d){
                    return yScale(d.sales);
                })).attr("id",total2[run][0].id)

        }
        svg.append("rect").attr("x", 70).attr("y", 630).attr("width", 10).attr("height",10).attr("fill", colors[0]);
        svg.append("rect").attr("x", 70).attr("y", 650).attr("width", 10).attr("height",10).attr("fill", colors[1]);
        svg.append("rect").attr("x", 70).attr("y", 670).attr("width", 10).attr("height",10).attr("fill", colors[2]);
        svg.append("rect").attr("x", 70).attr("y", 690).attr("width", 10).attr("height",10).attr("fill", colors[3]);
        svg.append("rect").attr("x", 140).attr("y", 630).attr("width", 10).attr("height",10).attr("fill", colors[4]);
        svg.append("rect").attr("x", 140).attr("y", 650).attr("width", 10).attr("height",10).attr("fill", colors[5]);
        svg.append("rect").attr("x", 140).attr("y", 670).attr("width", 10).attr("height",10).attr("fill", colors[6]);
        svg.append("rect").attr("x", 140).attr("y", 690).attr("width", 10).attr("height",10).attr("fill", colors[7]);
        svg.append("rect").attr("x", 210).attr("y", 630).attr("width", 10).attr("height",10).attr("fill", colors[8]);
        svg.append("rect").attr("x", 210).attr("y", 650).attr("width", 10).attr("height",10).attr("fill", colors[9]);
        svg.append("rect").attr("x", 210).attr("y", 670).attr("width", 10).attr("height",10).attr("fill", colors[10]);
        svg.append("rect").attr("x", 210).attr("y", 690).attr("width", 10).attr("height",10).attr("fill", colors[11]);
        svg.append("text").attr("x",85).attr("y", 639).attr("stroke", "black").attr("font-size", 15).text("Sports");
        svg.append("text").attr("x",85).attr("y", 659).attr("stroke", "black").attr("font-size", 15).text("Platform");
        svg.append("text").attr("x",85).attr("y", 679).attr("stroke", "black").attr("font-size", 15).text("Racing");
        svg.append("text").attr("x",85).attr("y", 699).attr("stroke", "black").attr("font-size", 15).text("RP");
        svg.append("text").attr("x",155).attr("y", 639).attr("stroke", "black").attr("font-size", 15).text("Puzzle");
        svg.append("text").attr("x",155).attr("y", 659).attr("stroke", "black").attr("font-size", 15).text("Misc");
        svg.append("text").attr("x",155).attr("y", 679).attr("stroke", "black").attr("font-size", 15).text("Shooter");
        svg.append("text").attr("x",155).attr("y", 699).attr("stroke", "black").attr("font-size", 15).text("Sim");
        svg.append("text").attr("x",225).attr("y", 639).attr("stroke", "black").attr("font-size", 15).text("Action");
        svg.append("text").attr("x",225).attr("y", 659).attr("stroke", "black").attr("font-size", 15).text("Adventure");
        svg.append("text").attr("x",225).attr("y", 679).attr("stroke", "black").attr("font-size", 15).text("Fighting");
        svg.append("text").attr("x",225).attr("y", 699).attr("stroke", "black").attr("font-size", 15).text("Strategy");
    })
</script>

</body>
</html>
