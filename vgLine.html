<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <title>Title</title>
</head>
<body>
<script>
    var canvasWidth=700;
    var canvasHeight=700;
    var margin= 200;
    var colors=["rgb(33, 118, 43)","rgb(231, 47, 68)","rgb(27, 107, 240)","rgb(240, 198, 15)","rgb(192, 71, 197)","rgb(215, 119, 130)","rgb(43, 220, 194)","rgb(111, 57, 20)","rgb(229, 175, 122)","rgb(38, 31, 34)","coral","maroon"]
    var svg = d3.select("body").append("svg")
        .attr("width",  canvasWidth)
        .attr("height", canvasHeight)
    var width = svg.attr("width") - margin;
    var height = svg.attr("height") - margin;
    var xScale= d3.scaleTime().range([0,width]);
    var yScale= d3.scaleLinear().range([height,0]);
    var container_g = svg.append("g")
        .attr("transform",
            "translate(" + 100 + ", " + 100 + ")");
    var date="12/31/"
    const format= d3.format("$.2s");
    var genre_data= new Set();
    var years_data= new Set();
    var sports_data= [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
    var platform_data= [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
    var racing_data= [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
    var roleplay_data= [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
    var puzzle_data= [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
    var misc_data= [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
    var shooter_data= [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
    var sim_data= [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
    var action_data= [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
    var fighting_data= [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
    var adventure_data= [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
    var strategy_data= [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
    d3.csv("vgsales.csv").then(data=>{
        data.forEach(game=>{
            genre_data.add(game.Genre)
            if(game.Year!="N/A"){
                years_data.add(game.Year)
            }

        })
        years_data= Array.from(years_data).sort();
        data.forEach(item=>{
            //console.log(years_data[0])
            if(item.Genre=="Sports"){
                for(let i=0; i<years_data.length; i++){
                    //console.log(item.Year==years_data[i])
                    if(item.Year==years_data[i]){
                        let temp= +item.Global_Sales
                        sports_data[i]= temp+sports_data[i];
                        //console.log(sports_data[i])
                    }
                }
            }
            if(item.Genre=="Platform"){
                for(let i=0; i<years_data.length; i++){
                    if(item.Year==years_data[i]){
                        let temp= +item.Global_Sales
                        platform_data[i]= temp+platform_data[i];
                    }
                }
            }
            if(item.Genre=="Racing"){
                for(let i=0; i<years_data.length; i++){
                    if(item.Year==years_data[i]){
                        let temp= +item.Global_Sales
                        racing_data[i]= temp+racing_data[i];
                    }
                }
            }
            if(item.Genre=="Role-Playing"){
                for(let i=0; i<years_data.length; i++){
                    if(item.Year==years_data[i]){
                        let temp= +item.Global_Sales
                        roleplay_data[i]= temp+roleplay_data[i];
                    }
                }
            }

            if(item.Genre=="Puzzle"){
                for(let i=0; i<years_data.length; i++){
                    if(item.Year==years_data[i]){
                        let temp= +item.Global_Sales
                        puzzle_data[i]= temp+puzzle_data[i];
                    }
                }
            }

            if(item.Genre=="Misc"){
                for(let i=0; i<years_data.length; i++){
                    if(item.Year==years_data[i]){
                        let temp= +item.Global_Sales
                        misc_data[i]= temp+misc_data[i];
                    }
                }
            }
            if(item.Genre=="Shooter"){
                for(let i=0; i<years_data.length; i++){
                    if(item.Year==years_data[i]){
                        let temp= +item.Global_Sales
                        shooter_data[i]= temp+shooter_data[i];
                    }
                }
            }
            if(item.Genre=="Simulation"){
                for(let i=0; i<years_data.length; i++){
                    if(item.Year==years_data[i]){
                        let temp= +item.Global_Sales
                        sim_data[i]= temp+sim_data[i];
                    }
                }
            }
            if(item.Genre=="Action"){
                for(let i=0; i<years_data.length; i++){
                    if(item.Year==years_data[i]){
                        let temp= +item.Global_Sales
                        action_data[i]= temp+action_data[i];
                    }
                }
            }
            if(item.Genre=="Fighting"){
                for(let i=0; i<years_data.length; i++){
                    if(item.Year==years_data[i]){
                        let temp= +item.Global_Sales
                        fighting_data[i]= temp+fighting_data[i];
                    }
                }
            }
            if(item.Genre=="Adventure"){
                for(let i=0; i<years_data.length; i++){
                    if(item.Year==years_data[i]){
                        let temp= +item.Global_Sales
                        adventure_data[i]= temp+adventure_data[i];
                    }
                }
            }
            if(item.Genre=="Strategy"){
                for(let i=0; i<years_data.length; i++){
                    if(item.Year==years_data[i]){
                        let temp= +item.Global_Sales
                        strategy_data[i]= temp+strategy_data[i];
                    }
                }
            }
        })
        var tSport_data=[]
        var tplat_data=[]
        var trace_data=[]
        var trole_data=[]
        var tpuzz_data=[]
        var tmisc_data=[]
        var tshooter_data=[]
        var tsim_data=[]
        var taction_data=[]
        var tfight_data=[]
        var tadventure_data=[]
        var tstrat_data=[]
        var datefina="31/12/2016"
        datefina=d3.timeParse("%m/%d/%Y")(datefina)
        for(let i=0; i<years_data.length-2; i++){
            tSport_data.push({year:d3.timeParse("%m/%d/%Y")(date+years_data[i]),sales:sports_data[i]})
            tplat_data.push({year:d3.timeParse("%m/%d/%Y")(date+years_data[i]),sales:platform_data[i]})
            trace_data.push({year:d3.timeParse("%m/%d/%Y")(date+years_data[i]),sales:racing_data[i]})
            trole_data.push({year:d3.timeParse("%m/%d/%Y")(date+years_data[i]),sales:roleplay_data[i]})
            tpuzz_data.push({year:d3.timeParse("%m/%d/%Y")(date+years_data[i]),sales:puzzle_data[i]})
            tmisc_data.push({year:d3.timeParse("%m/%d/%Y")(date+years_data[i]),sales:misc_data[i]})
            tshooter_data.push({year:d3.timeParse("%m/%d/%Y")(date+years_data[i]),sales:shooter_data[i]})
            tsim_data.push({year:d3.timeParse("%m/%d/%Y")(date+years_data[i]),sales:sim_data[i]})
            taction_data.push({year:d3.timeParse("%m/%d/%Y")(date+years_data[i]),sales:action_data[i]})
            tfight_data.push({year:d3.timeParse("%m/%d/%Y")(date+years_data[i]),sales:fighting_data[i]})
            tadventure_data.push({year:d3.timeParse("%m/%d/%Y")(date+years_data[i]),sales:adventure_data[i]})
            tstrat_data.push({year:d3.timeParse("%m/%d/%Y")(date+years_data[i]),sales:strategy_data[i]})
        }
        console.log(tSport_data)
        console.log(tplat_data)
        console.log(trace_data)
        console.log(trole_data)
        console.log(tshooter_data)
        console.log(tsim_data)
        console.log(tadventure_data)
        var total=[tSport_data,tplat_data,trace_data,trole_data,tpuzz_data,tmisc_data,tshooter_data,tsim_data,taction_data,tadventure_data,tfight_data,tstrat_data]
        console.log(total)
        //Below Works
        //console.log(date+years_data[0])
        xScale.domain(d3.extent(tSport_data, function(d){
            return d.year;
        }))
        var maxval=0;
        for(let i=0; i<total.length; i++){
            let tempval=d3.max(total[i],function(d){
                return d.sales;
            })
            if(tempval>maxval){
                maxval=tempval;
            }
        }
        yScale.domain([0,maxval])
        console.log(colors)
        container_g.append("g")
            .attr("transform", "translate(0, " + height + ")")
            .call(d3.axisBottom(xScale))
            .append("text")
            .attr("y", 50)
            .attr("x", 250)
            .attr("stroke", "black")
            .text("Years")
        container_g.append("g")
            .call(d3.axisLeft(yScale).tickFormat(function(d) {
                return format(d);
            }).ticks(10))
            .append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", -20)
            .attr("x", -200)
            .attr("dy", "-5.1em")
            .attr("stroke", "black")
            .text("Millions in Sales")
        container_g.append("path").datum(tSport_data)
            .attr("fill", "none")
            .attr("stroke", "coral")
            .attr("stroke-width",2)
            .attr("d",d3.line().x(function(d){
                return xScale(d.year);
            }).y(function(d){
                return yScale(d.sales);
            }))

        //TODO CREATE LINES
        for(let run=0; run<total.length; run++){
            container_g.append("path").datum(total[run])
                .attr("fill", "none")
                .attr("stroke", colors[run])
                .attr("stroke-width",2)
                .attr("d",d3.line().x(function(d){
                    return xScale(d.year);
                }).y(function(d){
                    return yScale(d.sales);
                }))
        }
        svg.append("rect").attr("x", 70).attr("y", 630).attr("width", 10).attr("height",10).attr("fill", colors[0]);
        svg.append("rect").attr("x", 70).attr("y", 650).attr("width", 10).attr("height",10).attr("fill", colors[1]);
        svg.append("rect").attr("x", 70).attr("y", 670).attr("width", 10).attr("height",10).attr("fill", colors[2]);
        svg.append("rect").attr("x", 70).attr("y", 690).attr("width", 10).attr("height",10).attr("fill", colors[3]);
        svg.append("rect").attr("x", 140).attr("y", 630).attr("width", 10).attr("height",10).attr("fill", colors[4]);
        svg.append("rect").attr("x", 140).attr("y", 650).attr("width", 10).attr("height",10).attr("fill", colors[5]);
        svg.append("rect").attr("x", 140).attr("y", 670).attr("width", 10).attr("height",10).attr("fill", colors[6]);
        svg.append("rect").attr("x", 140).attr("y", 690).attr("width", 10).attr("height",10).attr("fill", colors[7]);
        svg.append("rect").attr("x", 210).attr("y", 630).attr("width", 10).attr("height",10).attr("fill", colors[8]);
        svg.append("rect").attr("x", 210).attr("y", 650).attr("width", 10).attr("height",10).attr("fill", colors[9]);
        svg.append("rect").attr("x", 210).attr("y", 670).attr("width", 10).attr("height",10).attr("fill", colors[10]);
        svg.append("rect").attr("x", 210).attr("y", 690).attr("width", 10).attr("height",10).attr("fill", colors[11]);
        svg.append("text").attr("x",85).attr("y", 639).attr("stroke", "black").attr("font-size", 15).text("Sports");
        svg.append("text").attr("x",85).attr("y", 659).attr("stroke", "black").attr("font-size", 15).text("Platform");
        svg.append("text").attr("x",85).attr("y", 679).attr("stroke", "black").attr("font-size", 15).text("Racing");
        svg.append("text").attr("x",85).attr("y", 699).attr("stroke", "black").attr("font-size", 15).text("RP");
        svg.append("text").attr("x",155).attr("y", 639).attr("stroke", "black").attr("font-size", 15).text("Puzzle");
        svg.append("text").attr("x",155).attr("y", 659).attr("stroke", "black").attr("font-size", 15).text("Misc");
        svg.append("text").attr("x",155).attr("y", 679).attr("stroke", "black").attr("font-size", 15).text("Shooter");
        svg.append("text").attr("x",155).attr("y", 699).attr("stroke", "black").attr("font-size", 15).text("Sim");
        svg.append("text").attr("x",225).attr("y", 639).attr("stroke", "black").attr("font-size", 15).text("Action");
        svg.append("text").attr("x",225).attr("y", 659).attr("stroke", "black").attr("font-size", 15).text("Adventure");
        svg.append("text").attr("x",225).attr("y", 679).attr("stroke", "black").attr("font-size", 15).text("Fighting");
        svg.append("text").attr("x",225).attr("y", 699).attr("stroke", "black").attr("font-size", 15).text("Strategy");
    })
</script>

</body>
</html>
